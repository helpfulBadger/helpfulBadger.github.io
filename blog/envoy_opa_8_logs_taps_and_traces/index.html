<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>Configuring Envoy Logs, Taps and Traces - Helpful Badger&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="generator" content="Hugo 0.74.3" /><meta itemprop="name" content="Configuring Envoy Logs, Taps and Traces">
<meta itemprop="description" content="Learn how to configure Envoy&#39;s access logs, taps for capturing full requests &amp; responses and traces">
<meta itemprop="datePublished" content="2020-09-10T10:36:36-04:00" />
<meta itemprop="dateModified" content="2020-09-10T10:36:36-04:00" />
<meta itemprop="wordCount" content="2180">
<meta itemprop="image" content="https://helpfulbadger.github.io/img/2020/08/tap-dPr7uyrFMXo-unsplash.jpg">



<meta itemprop="keywords" content="logs,taps,traces,envoy," />
<meta property="og:title" content="Configuring Envoy Logs, Taps and Traces" />
<meta property="og:description" content="Learn how to configure Envoy&#39;s access logs, taps for capturing full requests &amp; responses and traces" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://helpfulbadger.github.io/blog/envoy_opa_8_logs_taps_and_traces/" />
<meta property="og:image" content="https://helpfulbadger.github.io/img/2020/08/tap-dPr7uyrFMXo-unsplash.jpg" />
<meta property="article:published_time" content="2020-09-10T10:36:36-04:00" />
<meta property="article:modified_time" content="2020-09-10T10:36:36-04:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://helpfulbadger.github.io/img/2020/08/tap-dPr7uyrFMXo-unsplash.jpg"/>

<meta name="twitter:title" content="Configuring Envoy Logs, Taps and Traces"/>
<meta name="twitter:description" content="Learn how to configure Envoy&#39;s access logs, taps for capturing full requests &amp; responses and traces"/>
<link rel="stylesheet" href="/css/bundle.min.182747932867f43d8c875b59a0300848b838002d4008d4a5b8ddcc41a37c4cf7.css" integrity="sha256-GCdHkyhn9D2Mh1tZoDAISLg4AC1ACNSluN3MQaN8TPc="><link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    

<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/" class="nav">
        
          
            Blog
          
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu menu">
      
        
          
          
            <a href="/" class="nav link"><i class='fa fa-home'></i> Home</a>
          
        
      
        
          
          
            <a href="/about/" class="nav link"><i class='far fa-id-card'></i> About</a>
          
        
      
        
          
          
            <a href="/blog/" class="nav link"><i class='far fa-newspaper'></i> Blog</a>
          
        
      
        
          
          
            <a href="/categories/" class="nav link"><i class='fas fa-sitemap'></i> Categories</a>
          
        
      
      <a href="#share-menu" class="nav share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      <a href="#search-input" class="nav search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a>
    </menu>
    <a href="#search-input" class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
    <a href="#share-menu" class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    
    <a href="#site-nav" class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="search" class="menu"><input id="search-input" class="search-input menu"></input><div id="search-results" class="search-results menu"></div></menu>
  
  
    <menu id="share-menu" class="flyout-menu menu">
      <h1>Share Post</h1>
      




  
    
    <a href="//twitter.com/share?text=Configuring%20Envoy%20Logs%2c%20Taps%20and%20Traces&amp;url=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <i class="fab fa-twitter"></i><p>&nbsp;Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <i class="fab fa-facebook"></i><p>&nbsp;Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f&amp;title=Configuring%20Envoy%20Logs%2c%20Taps%20and%20Traces" target="_blank" rel="noopener" class="nav share-btn reddit">
          <i class="fab fa-reddit-alien"></i><p>&nbsp;Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f&amp;title=Configuring%20Envoy%20Logs%2c%20Taps%20and%20Traces" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <i class="fab fa-linkedin"></i><p>&nbsp;LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f&amp;description=Configuring%20Envoy%20Logs%2c%20Taps%20and%20Traces" target="_blank" rel="noopener" class="nav share-btn pinterest">
          <i class="fab fa-pinterest-p"></i><p>&nbsp;Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by Helpful%20Badger&amp;body=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <i class="fas fa-envelope"></i><p>&nbsp;Email</p>
        </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro" class="hidden-single-column">
  <a href="/"><img src="https://helpfulbadger.github.io/img/main/unsplash_badger_small_2.png" class="circle" width="" alt="Helpful Badger in the wild" /></a>
  <header>
    <h1>Helpful Badger</h1>
  </header>
  <main>
    <p>Imagining the possibilities</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/helpfulBadger" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>











<li><a href="//linkedin.com/in/example" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>





























      </ul>
    </footer>
  
</section>

      <main id="site-main">
        
  <article class="post">
    <header>
  <div class="title">
    
      <h2><a href="/blog/envoy_opa_8_logs_taps_and_traces/">Configuring Envoy Logs, Taps and Traces</a></h2>
    
    
      <p>Learn how to configure Envoy&#39;s access logs, taps for capturing full requests &amp; responses and traces</p>
    
  </div>
  <div class="meta">
    <time class="published" datetime="2020-09-10 10:36:36 -0400 EDT">
      September 10, 2020
    </time>
    <span class="author">Helpful Badger</span>
    
      <p>11 minute read</p>
    
  </div>
</header>

    <section id="socnet-share">
      




  
    
    <a href="//twitter.com/share?text=Configuring%20Envoy%20Logs%2c%20Taps%20and%20Traces&amp;url=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <i class="fab fa-twitter"></i><p>&nbsp;Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <i class="fab fa-facebook"></i><p>&nbsp;Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f&amp;title=Configuring%20Envoy%20Logs%2c%20Taps%20and%20Traces" target="_blank" rel="noopener" class="nav share-btn reddit">
          <i class="fab fa-reddit-alien"></i><p>&nbsp;Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f&amp;title=Configuring%20Envoy%20Logs%2c%20Taps%20and%20Traces" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <i class="fab fa-linkedin"></i><p>&nbsp;LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f&amp;description=Configuring%20Envoy%20Logs%2c%20Taps%20and%20Traces" target="_blank" rel="noopener" class="nav share-btn pinterest">
          <i class="fab fa-pinterest-p"></i><p>&nbsp;Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by Helpful%20Badger&amp;body=https%3a%2f%2fhelpfulbadger.github.io%2fblog%2fenvoy_opa_8_logs_taps_and_traces%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <i class="fas fa-envelope"></i><p>&nbsp;Email</p>
        </a>
  


    </section>
    
  <a href="/blog/envoy_opa_8_logs_taps_and_traces/" class="image featured">
    
      <img src="https://helpfulbadger.github.io/img/2020/08/tap-dPr7uyrFMXo-unsplash.jpg" alt="">
    
  </a>


    <div class="content">
      <p><span>Photo by <a href="https://unsplash.com/@kazukyakayashi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Kazuky Akayashi</a> on <a href="https://unsplash.com/@kazukyakayashi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span></p>
<h1 id="getting-started-with-envoy--open-policy-agent-----08----">Getting Started with Envoy &amp; Open Policy Agent &mdash; 08 &mdash;</h1>
<h2 id="learn-how-to-configure-envoys-access-logs-taps-for-capturing-full-requests--responses-and-traces-for-capturing-end-to-end-flow">Learn how to configure Envoy&rsquo;s access logs, taps for capturing full requests &amp; responses and traces for capturing end to end flow</h2>
<p>This is the 8th Envoy &amp; Open Policy Agent Getting Started Guide. Each guide is intended to explore a single feature and walk through a simple implementation. Each guide builds on the concepts explored in the previous guide with the end goal of building a very powerful authorization service by the end of the series.</p>
<p>The source code for this getting started example is located on Github. <span style="color:blue"> &mdash;&mdash;&gt;  <a href="https://github.com/helpfulBadger/envoy_getting_started/tree/master/08_log_taps_traces">Envoy &amp; OPA GS # 8</a> </span></p>
<p>Here is a list of the Getting Started Guides that are currently available.</p>
<h2 id="getting-started-guides">Getting Started Guides</h2>
<ol>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_1_front_proxy/" title="Learn how to set up Envoy as a front proxy with docker">Using Envoy as a Front Proxy</a></span></li>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_2_adding_observability/" title="Learn how to add ElasticSearch and Kibana to your Envoy front proxy environment">Adding Observability Tools</a></span></li>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_3_adding_open_policy_agent/" title="Learn how to use Open Policy Agent with Envoy for more powerful authorization rules">Plugging Open Policy Agent into Envoy</a></span></li>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_4_opa_cli/" title="Learn how to use Open Policy Agent Command Line Interface">Using the Open Policy Agent CLI</a></span></li>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_5_opa_jws/" title="Learn how to validate JWS tokens with Open Policy Agent">JWS Token Validation with OPA</a></span></li>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_6_envoy_jws/" title="Learn how to validate JWS tokens natively with Envoy">JWS Token Validation with Envoy</a></span></li>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_7_app_contracts/" title="Learn how to Implement Application Specific Authorization Rules">Putting It All Together with Composite Authorization</a></span></li>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_8_logs_taps_and_traces/" title="Learn how to configure Envoy's access logs, taps for capturing full requests &amp; responses and traces">Configuring Envoy Logs Taps and Traces</a></span></li>
<li><span style="color:blue"><a href="https://helpfulbadger.github.io/blog/envoy_opa_9_sign_verify/" title="Learn how to use Envoy &amp; OPA to sign and validate HTTP Requests">Sign / Verify HTTP Requests</a></span></li>
</ol>
<h2 id="introduction">Introduction</h2>
<p>In this example we are going to use both a Front Proxy deployment and a service mesh deployment to centralize log configuration, capture full requests and responses with taps and to inject trace information. Logs and taps can be done transparently without the knowledge nor cooperation from our applications. However, for traces there cooperation from our app is required to forward the trace headers to the next link in the chain.</p>
<p>The diagram below shows what we will be building.</p>
<p><img class="special-img-class" src="/img/2020/09/Envoy-front proxy-gs_08_logs_taps_traces.svg" /><br></p>
<p>The Envoy instances throughout our network will be streaming logs, taps and traces on behalf of the applications involved in the request flow.</p>
<h2 id="lets-start-with-configuring-our-logs">Let&rsquo;s Start with Configuring Our Logs</h2>
<p>Envoy gives you the ability configure what it logs as a request goes though the proxy. Envoy&rsquo;s web site has documentation for <span style="color:blue"><a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#configuration">access log configuration</a></span>. There are a few things to be aware of:</p>
<ul>
<li>Each request / response header must be individually configured to make it to the logs. I haven&rsquo;t found a log-all-headers capability. This is can be a good thing because sensitive information doesn&rsquo;t get logged without a conscious decision to log it. On the other side of the coin, if you are using multiple trace providers, then you will miss trace headers from these other solutions until:
<ol>
<li>You are even aware that they are in use</li>
<li>You update the configuration for every node</li>
<li>There is no ability to run analytics from the time they started being used. You will only be able to go back to the time you became aware of these new headers and updated your configurations.</li>
</ol>
</li>
<li>The property name <code>match_config</code> that we use in this article is entering deprecation when Envoy 1.16 comes out. I&rsquo;ll will update this post to the new property name once 1.16 is released.</li>
<li>We will be using Elastic Common Schema in this example to the extent that we can with Envoy 1.15&rsquo;s configuration limitations.</li>
<li>Also coming with Envoy 1.16 will be nested JSON support. Once released I&rsquo;ll update the example to switch from the dot notation used here to nested JSON.</li>
</ul>
<p>Read through this snippet of envoy configuration. The full configuration files for our 3 envoy instances are located here:</p>
<ul>
<li><span style="color:blue"><a href="https://github.com/helpfulBadger/envoy_getting_started/blob/master/08_log_taps_traces/front-envoy-jaeger.yaml#L54-L119">Front Proxy&rsquo;s Configuration</a></span></li>
<li><span style="color:blue"><a href="https://github.com/helpfulBadger/envoy_getting_started/blob/master/08_log_taps_traces/service1-envoy-jaeger.yaml#L51-L116">Service 1&rsquo;s Envoy Configuration</a></span></li>
<li><span style="color:blue"><a href="https://github.com/helpfulBadger/envoy_getting_started/blob/master/08_log_taps_traces/service2-envoy-jaeger.yaml#L51-L116">Service 2&rsquo;s Envoy Configuration</a></span></li>
</ul>
<p>Elastic common schema was introduced to make it easier to analyze logs across applications. <span style="color:blue"><a href="https://www.elastic.co/blog/introducing-the-elastic-common-schema">This article on the elastic.co web site</a></span> is a good read and explains it in more detail. The <span style="color:blue"><a href="https://www.elastic.co/guide/en/ecs/current/index.html">reference for elastic common schema</a></span> provides names for many typical deployment environments, and cloud environments etc.</p>
<p>Below is the abbreviation envoy.yaml configuration that shows how to specify our logging configuration. The explanation of the configuration follows.</p>
<strong>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#00f">static_resources</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>  <span style="color:#00f">listeners</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  - <span style="color:#00f">address</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#00f">filter_chains</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    - <span style="color:#00f">filters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>      - <span style="color:#00f">name</span>: envoy.filters.network.http_connection_manager
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>        <span style="color:#00f">typed_config</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>          <span style="color:#00f">&#34;@type&#34;: </span>type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>          <span style="color:#00f">generate_request_id</span>: <span style="color:#00f">true</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>          ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>          <span style="color:#00f">route_config</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>          <span style="color:#00f">http_filters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>          ...
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#009c00">&gt;          access_log:</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>          - <span style="color:#00f">name</span>: envoy.access_loggers.file
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>            <span style="color:#00f">typed_config</span>:
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#009c00">&gt;              &#34;@type&#34;: type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog</span>
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#009c00">&gt;              path: &#34;/dev/stdout&#34;</span>
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#009c00">&gt;              typed_json_format: </span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>                <span style="color:#00f">&#34;@timestamp&#34;: </span><span style="color:#009c00">&#34;%START_TIME%&#34;</span>
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span style="color:#009c00">&gt;                client.address: &#34;%DOWNSTREAM_REMOTE_ADDRESS%&#34;</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>                <span style="color:#00f">client.local.address</span>: <span style="color:#009c00">&#34;%DOWNSTREAM_LOCAL_ADDRESS%&#34;</span>
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#009c00">&gt;                envoy.route.name: &#34;%ROUTE_NAME%&#34;</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>                <span style="color:#00f">envoy.upstream.cluster</span>: <span style="color:#009c00">&#34;%UPSTREAM_CLUSTER%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>                <span style="color:#00f">host.hostname</span>: <span style="color:#009c00">&#34;%HOSTNAME%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>                <span style="color:#00f">http.request.body.bytes</span>: <span style="color:#009c00">&#34;%BYTES_RECEIVED%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>                <span style="color:#00f">http.request.duration</span>: <span style="color:#009c00">&#34;%DURATION%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>                <span style="color:#00f">http.request.headers.accept</span>: <span style="color:#009c00">&#34;%REQ(ACCEPT)%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>                <span style="color:#00f">http.request.headers.authority</span>: <span style="color:#009c00">&#34;%REQ(:AUTHORITY)%&#34;</span>
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span style="color:#009c00">&gt;                http.request.headers.id: &#34;%REQ(X-REQUEST-ID)%&#34;</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>                <span style="color:#00f">http.request.headers.x_forwarded_for</span>: <span style="color:#009c00">&#34;%REQ(X-FORWARDED-FOR)%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>                <span style="color:#00f">http.request.headers.x_forwarded_proto</span>: <span style="color:#009c00">&#34;%REQ(X-FORWARDED-PROTO)%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>                <span style="color:#00f">http.request.headers.x_b3_traceid</span>: <span style="color:#009c00">&#34;%REQ(X-B3-TRACEID)%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>                <span style="color:#00f">http.request.headers.x_b3_parentspanid</span>: <span style="color:#009c00">&#34;%REQ(X-B3-PARENTSPANID)%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>                <span style="color:#00f">http.request.headers.x_b3_spanid</span>: <span style="color:#009c00">&#34;%REQ(X-B3-SPANID)%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>                <span style="color:#00f">http.request.headers.x_b3_sampled</span>: <span style="color:#009c00">&#34;%REQ(X-B3-SAMPLED)%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>                <span style="color:#00f">http.request.method</span>: <span style="color:#009c00">&#34;%REQ(:METHOD)%&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>                <span style="color:#00f">http.response.body.bytes</span>: <span style="color:#009c00">&#34;%BYTES_SENT%&#34;</span>
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span style="color:#009c00">&gt;                service.name: &#34;envoy&#34;</span>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>                <span style="color:#00f">service.version</span>: <span style="color:#009c00">&#34;1.16&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>                ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>  <span style="color:#00f">clusters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span style="color:#00f">admin</span>:
</code></pre></div></strong>
<p>The <code>access_log</code> configuration section is part of the HTTP Connection Manager Configuration and at the same nesting level as the <code>route_config</code> and <code>http_filters</code> sections.</p>
<ul>
<li>We use a typed config <code>type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog</code> in version 3 of the configuration API</li>
<li>The file path is set to standard out to so that log aggregation can be managed by docker.</li>
<li>The <code>typed_json_format</code> property is what allows us to create logs in JSON Lines format</li>
<li>Envoy gives us template strings to insert into the configuration that it will replace with the request specific values at run time. <code>client.address: &quot;%DOWNSTREAM_REMOTE_ADDRESS%&quot;</code>. In these examples, we have pretty much used every available template string. The client section of elastic common schema holds everything that we know about the client application that is originating the request. We use dot notation here since nested JSON support is not available in Envoy 1.15</li>
<li>Elastic Common Schema does not have standard names for everything. So we created a section for unique Envoy properties <code>envoy.route.name: &quot;%ROUTE_NAME%&quot;</code></li>
<li>The configuration language has macros that enable us to do lookups. In this example we lookup the X-Request-Id header and put it in the http.request.headers.id field <code>http.request.headers.id: &quot;%REQ(X-REQUEST-ID)%&quot;</code></li>
<li>We can insert static values into the logs for hardcoding labels such as which service the log entry is for etc. <code>service.name: &quot;envoy&quot;</code></li>
</ul>
<h2 id="now-lets-tackle-taps">Now Let&rsquo;s Tackle Taps</h2>
<p>Taps let us capture full requests and responses. More details are for <span style="color:blue"><a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/tap_filter">how the tap feature works</a></span> is located in the Envoy Documentation. There are 2 ways that we can capture taps:</p>
<ol>
<li>Statically configured with a local filesystem directory as the target for output. Envoy will store the request and response for each request in a separate file. The output directory must be specified with a trailing slash. Otherwise the files will not be written. The good news here is that you don&rsquo;t need log rotate. You can have a separate process scoop up each file, send the data to a log aggregator and then delete the file.</li>
<li>The second method for getting taps is by sending a configuration update to the admin port with a selection criteria and then holding the connection open while waiting for taps to stream in over the network. This would obviously be the preferred approach for a production environment.</li>
</ol>
<p>Below is abbreviated structure of our Envoy.yaml config file. The highlighted section is the tap configuration. Taps are simply another available HTTP filter.</p>
<ul>
<li>We have match configuration that allows us to selectively target what we tap and what we don&rsquo;t.</li>
<li>The output configuration section is where we specify where the taps should be sent. For the <code>file_per_tap</code> sink, remember to add the trailing slash to the path otherwise no files will be written. Additionally, the file path can&rsquo;t be set to standard out due to the expectation that new files will be opened under the subdirectory that is specified.</li>
</ul>
<strong>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#00f">static_resources</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>  <span style="color:#00f">listeners</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  - <span style="color:#00f">address</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#00f">filter_chains</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    - <span style="color:#00f">filters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>      - <span style="color:#00f">name</span>: envoy.filters.network.http_connection_manager
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>        <span style="color:#00f">typed_config</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>          <span style="color:#00f">&#34;@type&#34;: </span>type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>          <span style="color:#00f">route_config</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>          <span style="color:#00f">http_filters</span>:
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>          - <span style="color:#00f">name</span>: envoy.filters.http.tap
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>            <span style="color:#00f">typed_config</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>              <span style="color:#00f">&#34;@type&#34;: </span>type.googleapis.com/envoy.extensions.filters.http.tap.v3.Tap
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>              <span style="color:#00f">common_config</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>                <span style="color:#00f">static_config</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>                  <span style="color:#00f">match_config</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>                    <span style="color:#00f">any_match</span>: <span style="color:#00f">true</span>
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>                  <span style="color:#00f">output_config</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>                    <span style="color:#00f">sinks</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>                      - <span style="color:#00f">file_per_tap</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>                          <span style="color:#00f">path_prefix</span>: /tmp/any/
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>          - <span style="color:#00f">name</span>: envoy.filters.http.router
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>            <span style="color:#00f">typed_config</span>: {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>          <span style="color:#00f">access_log</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>          ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>  <span style="color:#00f">clusters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>  ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span style="color:#00f">admin</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>...
</code></pre></div></strong>
<blockquote>
<p>NOTE: The tap filter is experimental and is currently under active development. There is currently a very limited set of match conditions, output configuration, output sinks, etc. Capabilities will be expanded over time and the configuration structures are likely to change.</p>
</blockquote>
<h2 id="enabling-traces">Enabling Traces</h2>
<p>The <span style="color:blue"><a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/tracing#arch-overview-tracing">overview documentation for Envoy&rsquo;s Tracing features</a></span> succinctly describes Envoy&rsquo;s tracing capabilities very well. So, I have included a snippet here as a lead in to our configuration.</p>
<blockquote>
<p>Distributed tracing allows developers to obtain visualizations of call flows in large service oriented architectures. It can be invaluable in understanding serialization, parallelism, and sources of latency. Envoy supports three features related to system wide tracing:</p>
<ul>
<li>Request ID generation: Envoy will generate UUIDs when needed and populate the x-request-id HTTP header. Applications can forward the x-request-id header for unified logging as well as tracing. The behavior can be configured on per HTTP connection manager basis using an extension.</li>
<li>Client trace ID joining: The x-client-trace-id header can be used to join untrusted request IDs to the trusted internal x-request-id.</li>
<li>External trace service integration: Envoy supports pluggable external trace visualization providers, that are divided into two subgroups:
<ul>
<li>External tracers which are part of the Envoy code base, like LightStep, Zipkin or any Zipkin compatible backends (e.g. Jaeger), and Datadog.</li>
<li>External tracers which come as a third party plugin, like Instana.</li>
</ul>
</li>
</ul>
</blockquote>
<p>Tracing options are exploding and as such expect a lot of new capabilities to be added to Envoy. There are a great deal of configuration options already. We are demonstrating the simplest possible tracing solution. Therefore, configuration below leverages the built in support for Zipkin compatible backends (jaegar).</p>
<p>In lines 11 -19 below, the tracing configuration is standard part of the version 3 connection manager. The tracing property contains a provider.</p>
<ul>
<li>We have set up zipkin as the output format with jaegar as the configured destination. HTTP and gRPC are both supported. The example uses HTTP protocol for transmitting the traces.</li>
<li>Our trace configuration refers to a cluster that we have named jaeger. So, we need to add a cluster configuration for it in the clusters section of the configuration file. Lines 28 through 40 points Envoy to our all-in-one jaeger container and port 9411 on that container.</li>
</ul>
<strong>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#00f">static_resources</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>  <span style="color:#00f">listeners</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  - <span style="color:#00f">address</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#00f">filter_chains</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    - <span style="color:#00f">filters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>      - <span style="color:#00f">name</span>: envoy.filters.network.http_connection_manager
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>        <span style="color:#00f">typed_config</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>          <span style="color:#00f">&#34;@type&#34;: </span>type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>          <span style="color:#00f">generate_request_id</span>: <span style="color:#00f">true</span>
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#009c00">&gt;          tracing:</span>
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>            <span style="color:#00f">provider</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>              <span style="color:#00f">name</span>: envoy.tracers.zipkin
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>              <span style="color:#00f">typed_config</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>                <span style="color:#00f">&#34;@type&#34;: </span>type.googleapis.com/envoy.config.trace.v2.ZipkinConfig
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>                <span style="color:#00f">collector_cluster</span>: jaeger
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>                <span style="color:#00f">collector_endpoint</span>: <span style="color:#009c00">&#34;/api/v2/spans&#34;</span>
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>                <span style="color:#00f">shared_span_context</span>: <span style="color:#00f">false</span>
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>                <span style="color:#00f">collector_endpoint_version</span>: HTTP_JSON
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>          <span style="color:#00f">codec_type</span>: auto
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>          <span style="color:#00f">route_config</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>            ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>          <span style="color:#00f">http_filters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>            ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  <span style="color:#00f">clusters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>  - <span style="color:#00f">name</span>: service1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    ...
<span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span style="color:#009c00">&gt;  - name: jaeger</span>
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>    <span style="color:#00f">connect_timeout</span>: 1s
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>    <span style="color:#00f">type</span>: strict_dns
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>    <span style="color:#00f">lb_policy</span>: round_robin
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>    <span style="color:#00f">load_assignment</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>      <span style="color:#00f">cluster_name</span>: jaeger
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>      <span style="color:#00f">endpoints</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>      - <span style="color:#00f">lb_endpoints</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>        - <span style="color:#00f">endpoint</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>            <span style="color:#00f">address</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>              <span style="color:#00f">socket_address</span>:
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>                <span style="color:#00f">address</span>: jaeger
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>                <span style="color:#00f">port_value</span>: 9411
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span style="color:#00f">admin</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>  ...
</code></pre></div></strong>
<h1 id="running-the-solution">Running the Solution</h1>
<p>There is a bash script in the <code>08_log_taps_traces</code> directory that demonstrates the completed example. Just run <code>./demonstrate_log_tap_and_trace.sh</code> The script does the following:</p>
<ol>
<li>It cleans up any left over files from a previous run.</li>
<li>Creates temporary directories to hold the taps and log files that we will capture.</li>
<li>Starts up 3 envoy instances, 2 services, and jaeger as drawn in our diagram at the top of this article.</li>
<li>Shows the containers running for validation that there were no failures.</li>
<li>Sends a request through the Envoy front proxy and onwards through the service mesh.</li>
<li>Displays the custom access logs captured by each of the 3 Envoy proxies.</li>
</ol>
<blockquote>
<ul>
<li>These logs are captured in JSON Lines format.</li>
<li>They are run through a tool called <a href="https://github.com/stedolan/jq">jq</a> (running in a docker container).</li>
<li>JQ pretty prints each log line and sorts the keys to make it easier to see the data groupings.</li>
<li>Service 1 has 2 log lines since it captures the request as it goes into service 1 and it in turn calls service 2.</li>
</ul>
</blockquote>
<ol start="7">
<li>Shows the taps captured in all 3 envoy instances. These taps show the full request and response details.</li>
<li>The request and response bodies are base64 encoded in the taps in case they are binary. So, the script decodes each body that is available and shows it to the user.</li>
<li>It uses the open command to open Jaeger in a web browser. If it doesn&rsquo;t work on your operating system simply navigate to <code>http://localhost:16686/</code> on your own.</li>
<li>Finally it shuts down the environment. It leaves all of the logs and taps in the <code>tmp</code> directory for further inspection.</li>
</ol>
<h2 id="lets-take-a-look-at-our-traces">Let&rsquo;s take a look at our traces</h2>
<p><strong>Jaeger Landing Page</strong></p>
<p>The Jaeger landing page displays a summary of recent traces. It also enables filtering and selection of traces.</p>
<p><img class="special-img-class" src="/img/2020/09/08_jaeger_landing_page.png" /><br></p>
<p><strong>Call Graph</strong></p>
<p>The Jaeger call graph page shows the entire call tree. Ours is pretty simple. It also shows response time details and where this trace fits withing the norms.</p>
<p><img class="special-img-class" src="/img/2020/09/08_jaeger_graph_boxes.png" /><br></p>
<p><strong>Trace Details</strong></p>
<p>The Jaeger trace details page shows all of the tags that were captured at each leg of the request&rsquo;s journey.</p>
<p><img class="special-img-class" src="/img/2020/09/08_jaeger_display_trace.png" /><br></p>
<h1 id="congratulations">Congratulations</h1>
<p>We have completed a tour of another Envoy feature. These observability features will come in handy as our system becomes more complex. Additionally, Envoy is a very powerful tool for intercepting our traffic in a legacy environment. This can give all of our legacy applications consistently formatted data across our entire environment. This super-power can be incredibly critical in an environment with a lot of older applications that don&rsquo;t have active development, limited engineering knowledge and obsolete technology stacks.</p>

    </div>
    <footer>
      <ul class="stats">
  <li class="categories">
    <ul>
    
      
        
          <li><a class="article-terms-link" href="/categories/cloud/">cloud</a></li>
        
          <li><a class="article-terms-link" href="/categories/observability/">observability</a></li>
        
          <li><a class="article-terms-link" href="/categories/service-mesh/">service mesh</a></li>
        
      
    
    </ul>
  </li>
  <li class="tags">
    <ul>
    
      
        
          <li><a class="article-terms-link" href="/tags/logs/">logs</a></li>
        
          <li><a class="article-terms-link" href="/tags/taps/">taps</a></li>
        
          <li><a class="article-terms-link" href="/tags/traces/">traces</a></li>
        
          <li><a class="article-terms-link" href="/tags/envoy/">envoy</a></li>
        
      
    
    </ul>
  </li>
</ul>

    </footer>
  </article>
  

  <div class="pagination">
  
    <a href="/blog/envoy_opa_7_app_contracts/" class="button"><div class="previous"><div>Putting It All Together with Composite Authorization</div></div></a>
  
  
    <a href="/blog/envoy_opa_9_sign_verify/" class="button"><div class="next"><div>Signing HTTP Requests</div></div></a>
  
</div>


      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent posts</h1>
      </header>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/envoy_opa_9_sign_verify/" class="image featured">
    
      <img src="https://helpfulbadger.github.io/img/2020/10/lock-key-hRXIKdxoaPo-unsplash.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h2><a href="/blog/envoy_opa_9_sign_verify/">Signing HTTP Requests</a></h2>
          <time class="published" datetime="">October 7, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/envoy_opa_8_logs_taps_and_traces/" class="image featured">
    
      <img src="https://helpfulbadger.github.io/img/2020/08/tap-dPr7uyrFMXo-unsplash.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h2><a href="/blog/envoy_opa_8_logs_taps_and_traces/">Configuring Envoy Logs, Taps and Traces</a></h2>
          <time class="published" datetime="">September 10, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/envoy_opa_7_app_contracts/" class="image featured">
    
      <img src="https://helpfulbadger.github.io/img/2020/08/app-authorization-A6qNzfJXRGQ-unsplash.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h2><a href="/blog/envoy_opa_7_app_contracts/">Putting It All Together with Composite Authorization</a></h2>
          <time class="published" datetime="">September 7, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/envoy_opa_6_envoy_jws/" class="image featured">
    
      <img src="https://helpfulbadger.github.io/img/2020/08/jws-signatures-GJao3ZTX9gU-unsplash.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h2><a href="/blog/envoy_opa_6_envoy_jws/">JWS Signature Validation with Envoy</a></h2>
          <time class="published" datetime="">September 7, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/envoy_opa_5_opa_jws/" class="image featured">
    
      <img src="https://helpfulbadger.github.io/img/2020/08/jws-signatures-XQaqV5qYcXg-unsplash.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h2><a href="/blog/envoy_opa_5_opa_jws/">JWS Token Validation with OPA</a></h2>
          <time class="published" datetime="">September 7, 2020</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/blog/" class="button">See more</a>
        </footer>
      
    </section>
  

  
    
      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
            
          
          
          <li>
            
              <a href="/categories/cloud/">cloud<span class="count">9</span></a>
            
          
          <li>
            
              <a href="/categories/security/">security<span class="count">5</span></a>
            
          
          <li>
            
              <a href="/categories/service-mesh/">service-mesh<span class="count">5</span></a>
            
          
          <li>
            
              <a href="/categories/observability/">observability<span class="count">4</span></a>
            
          
          <li>
            
              <a href="/categories/authentication/">authentication<span class="count">3</span></a>
            
          
          </li>
        </ul>
      </section>
    
  

  
    <section id="mini-bio">
      <header>
        <h1>About</h1>
      </header>
      <p>Sharing perspectives.</p>
      <footer>
        <a href="/about" class="button">Learn More</a>
      </footer>
    </section>
  
</section>

      <footer id="site-footer">
  
      <ul class="socnet-icons">
        

        <li><a href="//github.com/helpfulBadger" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>











<li><a href="//linkedin.com/in/example" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>





























      </ul>
  
  <p class="copyright">
    
      &copy; 2020
      
        Helpful Badger&#39;s Blog
      
    . <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.74.3' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/bundle.min.a130f793c5bbd8f5902d41386b68a11988891ebc5f9a990f2176557ef014e758.js" integrity="sha256-oTD3k8W72PWQLUE4a2ihGYiJHrxfmpkPIXZVfvAU51g="></script>
    <script src="/js/add-on.js"></script>
    </div>
  </body>
</html>
